/* Picture - Picture element polyfill for responsive images. Authors & copyright (c) 2012: WebLinc, David Knight. */
/* NOTE: Depends on Media object. See https://github.com/weblinc/media-match */

(function(b){var t=b.document,n=0,u=/\b[\d\.]+x\b/g,v=/[^\s]+/g,p=b.Media.features.resolution,e=0;b.Picture={pictures:[],parse:function(){b.Picture.pictures=[];for(var q=t.getElementsByTagName("span"),c=q.length,f=null;c--&&(f=q[c]);)if(null!==f.getAttribute("data-picture")){for(var a=f.getElementsByTagName("span"),j=a.length,g=null,h="",k={},l="",d="",e="";j--&&(g=a[j]);){l=g.getAttribute("data-media");if(!(d=g.getAttribute("data-src")))a:{for(var d=g.getAttribute("data-srcset")||"",r=d.match(u)||
[],m=r.length;m--;){var s=96*parseFloat(r[m]);if(p===s||Math.floor(p)===Math.floor(s)){d=d.match(v)[2*(m%2)];break a}}d=null}l&&d?(k[l]=d,h+=(h.length?", ":"")+l):d&&(e=d)}Picture.pictures.push({element:f,media:h,src:k,srcDefault:e,matches:!1});n++}},watch:function(){clearTimeout(e);e=setTimeout(function(){var e=n;do{var c=b.Picture.pictures[e],f=[],a=null,j=!1,g="",a=!1;if("undefined"!==typeof c)if((a=b.Media.parseMatch(c.media,!0))&&c.matches!==a.media||!a&&c.srcDefault){if(c.matches=a&&a.media||
a,f=c.element.getElementsByTagName("img"),g=a.media&&c.src[a.media]||c.srcDefault){for(var h=0,k=f.length;h<k;h++)a=f[h],a.getAttribute("src")===g?(a.className="match",j=!0):"unmatch"!==a.className&&(a.className="unmatch");j||(a=document.createElement("img"),a.alt=c.element.getAttribute("data-title")||"picture",a.className="match",c.element.appendChild(a),a.src=g)}}else a||(c.matches=!1)}while(e--)},10)},init:function(){b.Picture.parse();b.Picture.watch();b.Media.listen(b.Picture.watch)}};b.addEventListener?
b.addEventListener("load",b.Picture.init):b.attachEvent("onload",b.Picture.init)})(window);