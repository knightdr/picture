/* Picture - Picture element polyfill for responsive images. Authors & copyright (c) 2012: WebLinc, David Knight. */
/* NOTE: Depends on Media object. See https://github.com/weblinc/media-match */

(function(b){function n(b,c){for(var e=b.match(f)||[],a=e.length,h=b.replace(f," ").match(s);a--;){var d=96*parseFloat(e[a]);if(j===d||!1===c&&Math.floor(j/96)===Math.floor(d/96))return h[a]}return"undefined"===typeof c?n(b,!1):null}var t=b.document,q=0,f=/\s+[\d\.]+x\s*,?/g,s=/[^\s]+/g,j=b.Media.features.resolution,k=0;b.Picture={pictures:[],parse:function(){b.Picture.pictures=[];for(var p=t.getElementsByTagName("span"),c=p.length,e=null;c--&&(e=p[c]);)if(null!==e.getAttribute("data-picture")){for(var a=
e.getElementsByTagName("span"),h=a.length,d=null,g="",r={},m="",l="",f="",j="",k="";h--&&(d=a[h]);)m=d.getAttribute("data-media"),l=d.getAttribute("data-src")||n(d.getAttribute("data-srcset")||""),j=d.getAttribute("width"),k=d.getAttribute("height"),m&&l?(r[m]=l,g+=(g.length?", ":"")+m):l&&(f=l);Picture.pictures.push({element:e,media:g,src:r,srcDefault:f,width:j,height:k,matches:!1});q++}},watch:function(){clearTimeout(k);k=setTimeout(function(){var f=q;do{var c=b.Picture.pictures[f],e=[],a=null,
h=!1,d="",a=!1;if("undefined"!==typeof c)if((a=b.Media.parseMatch(c.media,!0))&&c.matches!==a.media||!a&&c.srcDefault){if(c.matches=a&&a.media||a,e=c.element.getElementsByTagName("img"),d=a.media&&c.src[a.media]||c.srcDefault){for(var g=0,j=e.length;g<j;g++)a=e[g],a.getAttribute("src")===d?(a.className="match",h=!0):"unmatch"!==a.className&&(a.className="unmatch");h||(a=document.createElement("img"),a.alt=c.element.getAttribute("data-title")||"picture",a.width=c.width,a.height=c.height,a.className=
"match",c.element.appendChild(a),a.src=d)}}else a||(c.matches=!1)}while(f--)},10)},init:function(){b.Picture.parse();b.Picture.watch();b.Media.listen(b.Picture.watch)}};b.addEventListener?b.addEventListener("load",b.Picture.init):b.attachEvent("onload",b.Picture.init)})(window);