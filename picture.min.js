/* Picture - Picture element polyfill for responsive images. Authors & copyright (c) 2012: WebLinc, David Knight. */
/* NOTE: Depends on Media object. See https://github.com/weblinc/media-match */

(function(c){function p(c,b){for(var e=c.match(g)||[],a=e.length,j=c.replace(g," ").match(u);a--;){var d=96*parseFloat(e[a]);if(r===d||!1===b&&Math.floor(r/96)===Math.floor(d/96))return j[a]}return"undefined"===typeof b?p(c,!1):null}var v=c.document,s=0,g=/\s+[\d\.]+x\s*,?/g,u=/[^\s]+/g,r=c.Media.features.resolution,t=0;c.Picture={pictures:[],parse:function(){c.Picture.pictures=[];for(var q=v.getElementsByTagName("span"),b=q.length,e=null;b--&&(e=q[b]);)if(null!==e.getAttribute("data-picture")){for(var a=
e.getElementsByTagName("span"),j=a.length,d=null,f="",k={},h="",l="",g="",m="",n="";j--&&(d=a[j]);)h=d.getAttribute("data-media"),l=d.getAttribute("data-src")||p(d.getAttribute("data-srcset")||""),m=d.getAttribute("data-width")||"",n=d.getAttribute("data-height")||"",h&&l?(k[h]={uri:l,width:m,height:n},f+=(f.length?", ":"")+h):l&&(g={uri:l,width:m,height:n});Picture.pictures.push({element:e,media:f,src:k,srcDefault:g,matches:!1});s++}},watch:function(){clearTimeout(t);t=setTimeout(function(){var g=
s;do{var b=c.Picture.pictures[g],e=[],a=null,j=!1,d="",f="",k="",a=!1;if("undefined"!==typeof b)if((a=c.Media.parseMatch(b.media,!0))&&b.matches!==a.media||!a&&b.srcDefault.uri){if(b.matches=a&&a.media||a,e=b.element.getElementsByTagName("img"),a.media&&b.src[a.media].uri?(d=a.media&&b.src[a.media].uri,f=b.src[a.media].width,k=b.src[a.media].height):(d=b.srcDefault.uri,f=b.srcDefault.width,k=b.srcDefault.height),d){for(var h=0,l=e.length;h<l;h++)a=e[h],a.getAttribute("src")===d?(a.className="match",
j=!0):"unmatch"!==a.className&&(a.className="unmatch");j||(a=document.createElement("img"),a.alt=b.element.getAttribute("data-title")||"picture",f&&(a.width=f),k&&(a.height=k),a.className="match",b.element.appendChild(a),a.src=d)}}else a||(b.matches=!1)}while(g--)},10)},init:function(){c.Picture.parse();c.Picture.watch();c.Media.listen(c.Picture.watch)}};c.addEventListener?c.addEventListener("load",c.Picture.init):c.attachEvent("onload",c.Picture.init)})(window);